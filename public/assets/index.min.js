(async function(){"use strict";async function a(a){return await fetch(`${g}/token`,{method:"POST",body:JSON.stringify({token:a,dryrun:!0}),headers:{"Content-Type":"application/json"}})}async function b(a){return await fetch(`${g}/token`,{method:"POST",body:JSON.stringify({token:a,dryrun:!1}),headers:{"Content-Type":"application/json"}})}function c(a){if(a instanceof Array){const b=a.map(a=>c(a));return{dom:b.map(a=>a.dom),vars:b.reduce((a,b)=>({...a,...b.vars}),{})}}const b=document.createElement(a.tag),d=a.var?{[a.var]:b}:{};return a.attrs&&Object.entries(a.attrs).forEach(([a,c])=>b.setAttribute(a,c)),a.classList&&a.classList.forEach(a=>b.classList.add(a)),a.text&&(b.textContent=a.text),a.children&&a.children.map(a=>c(a)).forEach(a=>{b.appendChild(a.dom),Object.entries(a.vars).forEach(([a,b])=>d[a]=b)}),{dom:b,vars:d}}function d(a,b){const c={tag:"thead",children:[{tag:"tr",children:a.map(a=>({tag:"th",text:a}))}]},d={tag:"tbody",children:b.map(a=>({tag:"tr",children:a.map(a=>({tag:"td",text:a}))}))};return{tag:"table",children:[c,d]}}function e(a){return c({tag:"i",classList:[`icon-${a}`]}).dom}async function f(a,b){const c=b.textContent,d=e("spinner");d.classList.add("loading-spinner"),b.classList.remove("btn-next"),b.disabled=!0,b.textContent="",b.appendChild(d);const f=await a;return b.innerHTML="",b.classList.add("btn-next"),b.disabled=!1,b.textContent=c,f}const g="/api";const h=document.querySelector(".card header"),i=document.querySelector(".card .card-body"),j=document.querySelector(".card footer"),k=new class a{constructor(a,b,c){this.card={header:a,content:b,footer:c},this.screenNo=-1,this.steps=[]}init(a){this.forward(a)}addStep(a){this.steps.push(a)}forward(a){this.screenNo++,this.render(a)}back(a){this.screenNo--,this.render(a)}render(a){this.steps[this.screenNo](this.card,this,a)}}(h,i,j);k.addStep((b,d,g)=>{const h=c([{tag:"p",text:`To access ${g.name} please enter your access token below.`},{tag:"p",classList:["main-content"],children:[{tag:"label",attrs:{for:"token"},text:"Access Token"},{tag:"input",attrs:{type:"text",id:"token",placeholder:"CorrectHorseBatteryStaple",autocomplete:"off"},var:"input"}]},{tag:"p",classList:["feedback","text-error"],var:"feedback"}]),k=c({tag:"button",classList:["button","primary","btn-next"],text:"Next",var:"submit"});i.innerHTML="",j.innerHTML="",h.dom.forEach(a=>b.content.appendChild(a)),b.footer.appendChild(k.dom),k.vars.submit.addEventListener("click",async()=>{const b=h.vars.input.value;h.vars.feedback.innerHTML="";const i=await f(a(b),k.vars.submit);if(i.ok)d.forward({info:await i.json(),token:b,meta:g});else{let a="Unknown Error";404==i.status&&(a="Unknown Token"),h.vars.feedback.appendChild(e("error")),h.vars.feedback.appendChild(c({tag:"span",text:a}).dom)}})}),k.addStep((a,e,{info:g,token:h,meta:i})=>{a.content.innerHTML="",a.footer.innerHTML="";const j=new Date(Date.now()+1e3*g.token.refresh).toLocaleDateString(),k=c([{tag:"p",text:"Access token validated. Please confirm your access rights below."},{tag:"p",text:`Access will expire on ${j}. Please re-enter your token at that time.`},{tag:"p",classList:["main-content"],children:[{tag:"h4",children:[{tag:"b",text:"From: "},{tag:"code",text:g.requester}]},d(["Host","Port","Action"],g.token.access.flatMap(a=>a.ports.map(b=>[a.host,b,"Allow"])))]}]),l=c([{tag:"button",classList:["button","secondary","btn-prev"],text:"Back",var:"back"},{tag:"button",classList:["button","primary","btn-next"],text:"Confirm",var:"confirm"}]);k.dom.forEach(b=>a.content.appendChild(b)),l.dom.forEach(b=>a.footer.appendChild(b)),l.vars.back.addEventListener("click",()=>{e.back(i)}),l.vars.confirm.addEventListener("click",async()=>{await f(b(h),l.vars.confirm),e.forward()})}),k.addStep(a=>{a.content.innerHTML="",a.footer.innerHTML="";const b=c({tag:"p",classList:["text-center","main-content"],text:"Access has been successfully provisioned. You may now close the page."});a.content.appendChild(b.dom)});const l=await async function(){return await fetch(`${g}/heimdallr`)}();k.init(await l.json())})();
